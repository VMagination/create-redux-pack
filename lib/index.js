"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var redux=require("redux"),reselect=require("reselect"),fastEquals=require("fast-equals");function _arrayWithHoles(e){if(Array.isArray(e))return e}var arrayWithHoles=_arrayWithHoles;function _iterableToArrayLimit(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var r=[],a=!0,n=!1,o=void 0;try{for(var c,i=e[Symbol.iterator]();!(a=(c=i.next()).done)&&(r.push(c.value),!t||r.length!==t);a=!0);}catch(e){n=!0,o=e}finally{try{a||null==i.return||i.return()}finally{if(n)throw o}}return r}}var iterableToArrayLimit=_iterableToArrayLimit;function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,a=new Array(t);r<t;r++)a[r]=e[r];return a}var arrayLikeToArray=_arrayLikeToArray;function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return arrayLikeToArray(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(r="Object"===r&&e.constructor?e.constructor.name:r)||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?arrayLikeToArray(e,t):void 0}}var unsupportedIterableToArray=_unsupportedIterableToArray;function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var nonIterableRest=_nonIterableRest;function _slicedToArray(e,t){return arrayWithHoles(e)||iterableToArrayLimit(e,t)||unsupportedIterableToArray(e,t)||nonIterableRest()}var slicedToArray=_slicedToArray;function createCommonjsModule(e,t){return e(t={exports:{}},t.exports),t.exports}var _typeof_1=createCommonjsModule(function(t){function r(e){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?t.exports=r=function(e){return typeof e}:t.exports=r=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}t.exports=r});function _defineProperty$1(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var defineProperty$1=_defineProperty$1;function ownKeys(t,e){var r,a=Object.keys(t);return Object.getOwnPropertySymbols&&(r=Object.getOwnPropertySymbols(t),e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),a.push.apply(a,r)),a}function _objectSpread2(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(r),!0).forEach(function(e){defineProperty$1(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):ownKeys(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}var objectSpread2=_objectSpread2;function _defineProperty(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}var defineProperty=_defineProperty;function _arrayWithoutHoles(e){if(Array.isArray(e))return arrayLikeToArray(e)}var arrayWithoutHoles=_arrayWithoutHoles;function _iterableToArray(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}var iterableToArray=_iterableToArray;function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var nonIterableSpread=_nonIterableSpread;function _toConsumableArray(e){return arrayWithoutHoles(e)||iterableToArray(e)||unsupportedIterableToArray(e)||nonIterableSpread()}var toConsumableArray=_toConsumableArray,empty=Symbol("[CRPack value]: empty"),removeMark=Symbol("[CRPack value]: marked for removal"),removeMarked=function r(a){a&&"object"===_typeof_1(a)&&Object.entries(a).forEach(function(e){var t=slicedToArray(e,2),e=t[0];t[1]===removeMark?delete a[e]:r(a[e])})},createReducerCase=function(a){return function(e,t,r){t=objectSpread2(objectSpread2({},r?{}:e),a(e,t,r));return r||removeMarked(t),t}},mergeGenerators=function(){for(var e=arguments.length,o=new Array(e),t=0;t<e;t++)o[t]=arguments[t];try{var r=toConsumableArray(new Set(o.reduce(function(e,t){return[].concat(toConsumableArray(e),toConsumableArray(Object.keys(t)))},[]))),a=function(){return{}};r.includes("reducer")&&(a=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var c=o.filter(function(e){return e.hasOwnProperty("reducer")}).map(function(e){return e.reducer.apply(e,t)}).filter(function(e){var t;return e&&"object"===_typeof_1(e)&&"Object"===(null==e||null===(t=e.constructor)||void 0===t?void 0:t.name)});return toConsumableArray(new Set(c.reduce(function(e,t){return[].concat(toConsumableArray(e),toConsumableArray(Object.keys(t)))},[]))).reduce(function(e,o){return objectSpread2(objectSpread2({},e),{},defineProperty({},o,function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length?arguments[1]:void 0,e=2<arguments.length&&void 0!==arguments[2]&&arguments[2];return c.filter(function(e){return e.hasOwnProperty(o)}).reduce(function(e,t){var r=t[o](a,n,!0),t=Object.keys(r);t.length>=Object.keys(a).length&&(console.warn("CRPack: mergeGenerators received a reducer case with state directly added in result, to improve performance please use createReducerCase and prevent previous state from spreading into result, found in",o),r=t.reduce(function(e,t){return objectSpread2(objectSpread2({},e),a[t]&&r[t]===a[t]?{}:defineProperty({},t,r[t]))},{}));e=objectSpread2(objectSpread2({},e),r);return removeMarked(e),e},e?{}:objectSpread2({},a))}))},{})});var n=r.reduce(function(e,n){return objectSpread2(objectSpread2({},e),{},defineProperty({},n,function(){for(var e=arguments.length,a=new Array(e),t=0;t<e;t++)a[t]=arguments[t];return o.filter(function(e){return e.hasOwnProperty(n)}).reduce(function(e,t){var r=t[n].apply(t,a);return r&&"object"===_typeof_1(r)?objectSpread2(objectSpread2({},e),t[n].apply(t,a)):t[n].apply(t,a)},{})}))},{});return objectSpread2(objectSpread2({},n),{},{reducer:a})}catch(e){throw new Error("CRPack: mergeGenerators received invalid generators")}};function createBaseAction(t,r){function e(){if(r){var e=null!==(e=r.apply(void 0,arguments))&&void 0!==e?e:{};return objectSpread2(objectSpread2({type:t,payload:null==e?void 0:e.payload},"meta"in e&&{meta:e.meta}),"error"in e&&{error:e.error})}return{type:t,payload:arguments.length<=0?void 0:arguments[0]}}return e.toString=function(){return"".concat(t)},e.type=t,e}var createAction=function(n,o){return Object.assign(createBaseAction(n,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return{payload:o?o.apply(void 0,t):t.length<=1?t[0]:t}}),{instances:new Proxy({},{get:function(e,a,t){var r=Reflect.get(e,a,t);return r||("string"!=typeof a?r:(Reflect.set(e,a,createBaseAction(n,function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return{payload:o?o.apply(void 0,t):t.length<=1?t[0]:t,meta:{instance:a}}}),t),Reflect.get(e,a,t)))}})})},createSelector=function(t,r){return reselect.createSelector("string"==typeof t?function(e){return e[t]}:t,"string"==typeof r?function(e){return e[r]}:r)},mergeObjects=function(e,t){e=objectSpread2({},e);return function t(r,a){return Object.keys(null!=a?a:{}).forEach(function(e){a[e]instanceof Object&&e in r&&Object.assign(a[e],t(r[e],a[e]))}),Object.assign(null!=r?r:{},a),r}(e,t),e};function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};for(var r,a={},n=Object.keys(e),o=0;o<n.length;o++)r=n[o],0<=t.indexOf(r)||(a[r]=e[r]);return a}var objectWithoutPropertiesLoose=_objectWithoutPropertiesLoose;function _objectWithoutProperties(e,t){if(null==e)return{};var r,a=objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols)for(var n=Object.getOwnPropertySymbols(e),o=0;o<n.length;o++)r=n[o],0<=t.indexOf(r)||Object.prototype.propertyIsEnumerable.call(e,r)&&(a[r]=e[r]);return a}var objectWithoutProperties=_objectWithoutProperties,formatComplete=Symbol("format complete"),generateId=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:9;return a<=10?Math.random().toString(36).substr(2,a):Array(Math.ceil(a/10)).fill(null).reduce(function(e,t,r){r=10<=a-10*r?10:a%10;return e+Math.random().toString(36).substr(2,r).padEnd(r,"0")},"")},formatParams=function(e,t){try{var r=e.name,a=void 0===r?"NamelessPack":r,n=e.reducerName,o=void 0===n?"UnspecifiedReducer":n,c=e.template,i=void 0===c?"request":c,u=e.idGeneration,l=void 0===u?t:u,d=objectWithoutProperties(e,["name","reducerName","template","idGeneration"]);if(formatComplete in d)return e;var s="[".concat(a,"]: CRPack-").concat(l?generateId():"static");return objectSpread2(defineProperty({name:s,reducerName:o,originalName:a,template:i},formatComplete,!0),d)}catch(e){throw Error("CRPack received invalid package info")}},RESET_ACTION_TYPE="[CRPack]: Reset action ".concat(generateId(3)),resetAction=Object.assign(function(){return{type:RESET_ACTION_TYPE}},{type:RESET_ACTION_TYPE}),CRPackRegex=/\[.+]: CRPack-(.{9}|static)/,hasCRPackName=function(e){return CRPackRegex.test(e)},makeKeysReadable=function(e){return e&&"object"===_typeof_1(e)?function r(e){var t=Object.keys(e||{}).filter(hasCRPackName);if(!t.length)return e;var a=objectSpread2({},e);return t.forEach(function(e){var t=e.match(/\.([^. ]+) /)||[],t=slicedToArray(t,2)[1];t&&(a[t]=r(a[e]),delete a[e])}),a}(objectSpread2({},e)):e},getReadableKey=function(e){return hasCRPackName(e)?e.replace(/ of .+$/,""):e},getRunName=function(e){return"run ".concat(e)},getSuccessName=function(e){return"success ".concat(e)},getSetName=function(e){return"set ".concat(e)},getResetName=function(e){return"reset ".concat(e)},getFailName=function(e){return"fail ".concat(e)},getLoadingName=function(e){return"isLoading ".concat(e)},getResultName=function(e){return"result ".concat(e)},getValueName=function(e){return"value ".concat(e)},getErrorName=function(e){return"error ".concat(e)},DefaultStateNames={result:getResultName,value:getValueName,isLoading:getLoadingName,error:getErrorName},getKeyName=function(e,t){var r;return(null===(r=DefaultStateNames[t])||void 0===r?void 0:r.call(DefaultStateNames,e))||(hasCRPackName(t)?t:"".concat(t," of ").concat(e))},getActionName=function(e,t){return"".concat(t," ").concat(e)},getNameWithInstance=function(e,t){return t?"".concat(e," [Instance]: ").concat(t):e},normalizeValue=function(e){return e?"object"===_typeof_1(e)&&Array.isArray(e)?e.map(function(e){return"".concat(e)}):"".concat(e):""},mergableRemoveSymbol=Symbol("[CRPack-mergable-".concat(generateId(5),"]: remove field")).toString(),mergePayloadByKey=function(e,t,r){if(r&&t&&"object"===_typeof_1(t)&&e&&"object"===_typeof_1(e)){if(Array.isArray(e)){if(Array.isArray(t)){var a=t.map(function(e){return e[r]});return[].concat(toConsumableArray(e.filter(function(e){e=e[r];return!normalizeValue(a).includes(normalizeValue(e))})),toConsumableArray(t))}return[].concat(toConsumableArray(e.filter(function(e){e=e[r];return normalizeValue(t[r])!==normalizeValue(e)})),[t])}if(Array.isArray(t))return objectSpread2(objectSpread2({},e),t.reduce(function(e,t){return objectSpread2(objectSpread2({},e),{},defineProperty({},t[r],t))},{}));if(t[r])return objectSpread2(objectSpread2({},e),{},defineProperty({},t[r],t));if(Object.values(t).every(function(e){return null==e?void 0:e[r]})){var n=Object.values(t);return objectSpread2(objectSpread2({},e),n.reduce(function(e,t){return objectSpread2(objectSpread2({},e),{},defineProperty({},t[r],t))},{}))}return Object.entries(objectSpread2(objectSpread2({},e),t)).reduce(function(e,t){var r=slicedToArray(t,2),t=r[0],r=r[1];return r!==mergableRemoveSymbol?objectSpread2(objectSpread2({},e),{},defineProperty({},t,r)):e},{})}return r&&!t?e:t},selectorWithInstances=function(n,o,c){var t=3<arguments.length&&void 0!==arguments[3]?arguments[3]:function(e){return e};return Object.assign(reselect.createSelector(n,function(e){return t((e||{})[o])}),{instances:new Proxy({},{get:function(e,t,r){var a=Reflect.get(e,t,r);return a||("string"!=typeof t?a:(Reflect.set(e,t,reselect.createSelector(n,function(e){return null!==(e=e[getNameWithInstance(o,t)])&&void 0!==e?e:c}),r),Reflect.get(e,t,r)))}})})},shouldRecursionEnd=function(e){return"initial"in e},isTreeEmpty=function t(r){var e=Object.keys(r);return Boolean(e.length)&&e.every(function(e){return r[e]&&"object"===_typeof_1(r[e])?t(r[e]):r[e]===empty})},setEmptyTrees=function t(r){return r&&"object"===_typeof_1(r)&&Object.keys(r).forEach(function(e){if(r[e]&&"object"===_typeof_1(r[e]))return isTreeEmpty(r[e])?r[e]=empty:t(r[e])}),r},removeEmpties=function t(r){return(!(1<arguments.length&&void 0!==arguments[1])||arguments[1])&&setEmptyTrees(r),Object.keys(r).forEach(function(e){return r[e]===empty?delete r[e]:r[e]&&"object"===_typeof_1(r[e])&&t(r[e])}),r},addStateParam=function(e){var t,r,a,n=e.obj,o=e.key,c=e.payloadMap,i=e.name,u=e.reducerName,l=e.payload,d=e.payloadField,s=e.state,f=e.mainState,p=e.instance,y=e.action,m=e.isMainAction,e=e.prefix,g=void 0===e?"":e,b=c[o],c=null==b?void 0:b.instanced,c=Array.isArray(c)?c.includes(y):null==b?void 0:b.instanced,v=getNameWithInstance(getKeyName(i,"".concat(g).concat(o)),c?p:void 0);null!=b&&null!==(t=b.actionToValue)&&void 0!==t&&t[y]||m&&(null==b||!b.actions)||null!=b&&null!==(r=b.actions)&&void 0!==r&&r.includes(y)?(d=null!==(d=(r=(null==b?void 0:b.formatPayload)||(null==b?void 0:b.formatMergePayload))?r(l,y,mergableRemoveSymbol):d)&&void 0!==d?d:null==b?void 0:b.fallback,d=(a=("actionToValue"in b&&"function"==typeof(null==b?void 0:b.actionToValue)?null==b?void 0:b.actionToValue:null==b||null===(a=b.actionToValue)||void 0===a?void 0:a[y])||(null==b?void 0:b.modifyValue))?a(null!=b&&b.actionToValue?null!=l?l:null==b?void 0:b.fallback:d,null!==(l=s[v])&&void 0!==l?l:null==b?void 0:b.initial,{code:y,instance:p,forceInstance:function(e){v=getNameWithInstance(getKeyName(i,"".concat(g).concat(o)),e)},updateInstances:function(e){e&&Object.entries(e).forEach(function(e){var t=slicedToArray(e,2),e=t[0],t=t[1],e=getNameWithInstance(getKeyName(i,"".concat(g).concat(o)),e);n[e]="function"==typeof t?t(null!==(e=s[e])&&void 0!==e?e:null==b?void 0:b.initial):t})},getInstancedValue:function(e){return null!==(e=s[getNameWithInstance(getKeyName(i,"".concat(g).concat(o)),e)])&&void 0!==e?e:null==b?void 0:b.initial},getStateWithSelector:function(e){return e(defineProperty({},u,f))}}):mergePayloadByKey(null!==(y=s[v])&&void 0!==y?y:null==b?void 0:b.initial,d,null==b?void 0:b.mergeByKey),console.assert(!(v.includes("field2")&&v.includes("asd")&&c&&p&&!Object.keys(d).length),JSON.stringify({stateKey:v,newValue:JSON.stringify(d),initial:JSON.stringify(null==b?void 0:b.initial),isEqual:fastEquals.deepEqual(d,null==b?void 0:b.initial)})),n[v]=c&&p&&fastEquals.deepEqual(d,null==b?void 0:b.initial)?removeMark:d):DefaultStateNames["".concat(g).concat(o)]||(n[v]=empty)},addMappedPayloadToState=function n(e){var o=e.reducerName,c=e.obj,i=e.payloadMap,u=e.name,l=e.payload,d=e.payloadField,s=e.state,f=e.mainState,p=e.action,y=e.instance,t=e.isMainAction,m=void 0!==t&&t,t=e.prefix,g=void 0===t?"":t,e=e.isTop,b=void 0===e||e;Object.keys(i).forEach(function(e){var t=i[e];if(shouldRecursionEnd(t))return addStateParam({reducerName:o,obj:c,key:e,payloadMap:i,name:u,payload:l,payloadField:null==d?void 0:d[e],state:s,mainState:f,action:p,instance:y,isMainAction:m,prefix:g}),void(b&&(setEmptyTrees(c),removeEmpties(c)));var r=getKeyName(u,"".concat(g).concat(e));c[r]=objectSpread2(objectSpread2({},s[r]),c[r]||{});var a="".concat(g).concat(getReadableKey(e),".");n({reducerName:o,obj:c[r],payloadMap:t,name:u,payload:l,payloadField:null==d?void 0:d[e],state:s[r],mainState:f,action:p,instance:y,isMainAction:m,prefix:a,isTop:!1}),b&&(setEmptyTrees(c),removeEmpties(c))})},getInitial=function(e,t,r,a){var n={};return addMappedInitialToState(n,e,t,r,a),n},addMappedInitialToState=function n(o,c,i,u,l){var d=5<arguments.length&&void 0!==arguments[5]?arguments[5]:"";Object.keys(c).forEach(function(e){var t,r=c[e],a=getKeyName(i,"".concat(d).concat(e));shouldRecursionEnd(r)?(t=null==r?void 0:r.instanced,t=Array.isArray(t)?t.includes(l):null==r?void 0:r.instanced,o[getNameWithInstance(a,t?u:void 0)]=r.initial):(e="".concat(d).concat(getReadableKey(e),"."),o[a]=o[a]||{},n(o[a],r,i,u,l,e))})},getStateNames=function(e,t){var r={};return addMappedStateNames(r,e,t),r},wrapStateName=function r(a){return new Proxy(new String(a),{get:function(e,t){return"function"==typeof e[t]?e[t].bind(a):"string"==typeof t?t in e&&e[t]||r(t):e[t]}})},addMappedStateNames=function n(o,c,i){var u=3<arguments.length&&void 0!==arguments[3]?arguments[3]:"";Object.keys(c).forEach(function(e){var t,r,a=c[e];shouldRecursionEnd(a)?o[e]=wrapStateName(getKeyName(i,"".concat(u).concat(e))):(t={},r="".concat(u).concat(getReadableKey(e),"."),n(t,a,i,r),o[e]=Object.assign(getKeyName(i,"".concat(u).concat(e)),t))})},getSelectors=function(e,t,r){var a={};return addMappedSelectors(a,e,t,r),a},selectorContent=Symbol("CRPack selector content"),wrapSelector=function a(n,o){var t=2<arguments.length&&void 0!==arguments[2]?arguments[2]:function(e){return e},e=3<arguments.length&&void 0!==arguments[3]?arguments[3]:void 0;return new Proxy(4<arguments.length&&void 0!==arguments[4]&&arguments[4]?selectorWithInstances(n,o,e,t):reselect.createSelector(n,function(e){return t((e||{})[o])}),{get:function(e,t,r){return Reflect.get(e,t,r)?Reflect.get(e,t,r):(e[selectorContent]?e[selectorContent][t]||(e[selectorContent][t]=a(reselect.createSelector(n,function(e){return(e||{})[o]}),t)):e[selectorContent]=defineProperty({},t,a(reselect.createSelector(n,function(e){return(e||{})[o]}),t)),e[selectorContent][t])}})},addMappedSelectors=function c(i,u,l,d){var s=4<arguments.length&&void 0!==arguments[4]?arguments[4]:"";Object.keys(u).forEach(function(e){var t,r,a,n=u[e],o=getKeyName(l,"".concat(s).concat(e));shouldRecursionEnd(n)?(a=(null==n?void 0:n.formatSelector)||function(e){return e},i[e]=wrapSelector(d,o,a,null==n?void 0:n.initial,!0)):(t={},r=reselect.createSelector(d,function(e){var t,r=(t=null,function(e){return t=t||makeKeysReadable(e)});return e[o]&&"object"===_typeof_1(e[o])?new Proxy(objectSpread2({},e[o]),{get:function(e,t){return(t in e?e:r(e))[t]},has:function(e,t){return t in e||t in r(e)},ownKeys:function(e){return Reflect.ownKeys(r(e))},getOwnPropertyDescriptor:function(e,t){return Reflect.getOwnPropertyDescriptor(r(e),t)}}):e[o]}),a="".concat(s).concat(getReadableKey(e),"."),c(t,n,l,r,a),i[e]=Object.assign(r,t))})},cached=Symbol("[CRPack]: cached"),getLazyPack=function(o,c){for(var e=arguments.length,i=new Array(2<e?e-2:0),t=2;t<e;t++)i[t-2]=arguments[t];return new Proxy(objectSpread2(objectSpread2({},o),{},defineProperty({},cached,{})),{get:function(e,t,r){var a=t,n=c.originalName.replace(/^\S/,function(e){return e.toLowerCase()});!o.hasOwnProperty(t)&&"string"==typeof t&&t.startsWith(n)&&t!==n&&(a=t.replace(n,"").replace(/^\S/,function(e){return e.toLowerCase()}));n=Reflect.get(e,a,r),r=Reflect.get(e,cached,r);if("name"===a)return c.name;if(o.hasOwnProperty(a)){if(a in r)return r[a];r=n.apply(void 0,[c].concat(i));return Reflect.set(e[cached],a,r),r}return n}})},createReducer=function(r,a,n){return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:r,t=1<arguments.length?arguments[1]:void 0;return a.hasOwnProperty(t.type)?a[t.type](e,t):n?null==n?void 0:n(e,t):e}},requestDefaultActions=["run","success","fail"],requestGen={actions:function(e){var r=e.name,e=e.actions;return objectSpread2({run:createAction(getRunName(r)),success:createAction(getSuccessName(r)),fail:createAction(getFailName(r))},(e||[]).filter(function(e){return!requestDefaultActions.includes(e)}).reduce(function(e,t){return objectSpread2(objectSpread2({},e),{},defineProperty({},t,createAction(getActionName(r,t))))},{}))},actionNames:function(e){var r=e.name,e=e.actions;return objectSpread2({run:getRunName(r),success:getSuccessName(r),fail:getFailName(r)},(e||[]).filter(function(e){return!requestDefaultActions.includes(e)}).reduce(function(e,t){return objectSpread2(objectSpread2({},e),{},defineProperty({},t,getActionName(r,t)))},{}))},selectors:function(e){var t=e.name,r=e.reducerName,a=e.payloadMap,n=void 0===a?{}:a,a=e.defaultInitial,e=function(e){return e[r]};return objectSpread2({isLoading:selectorWithInstances(e,DefaultStateNames.isLoading(t),!1),result:selectorWithInstances(e,DefaultStateNames.result(t),a)},getSelectors(n,t,e))},initialState:function(e){var t=e.name,r=e.defaultInitial,a=void 0===r?null:r,r=e.payloadMap,e=void 0===r?{}:r;return objectSpread2((defineProperty(r={},DefaultStateNames.isLoading(t),!1),defineProperty(r,DefaultStateNames.result(t),a),r),getInitial(e,t))},stateNames:function(e){var t=e.name,e=e.payloadMap,e=void 0===e?{}:e;return objectSpread2({isLoading:DefaultStateNames.isLoading(t),result:DefaultStateNames.result(t)},getStateNames(e,t))},reducer:function(e){var i=e.name,u=e.reducerName,l=e.formatPayload,d=e.formatMergePayload,s=e.mergeByKey,f=e.modifyValue,p=e.actionToValue,y=e.defaultFallback,m=e.defaultInitial,g=e.defaultInstanced,t=e.actions,e=e.payloadMap,b=void 0===e?{}:e;return objectSpread2(objectSpread2({},(t||[]).filter(function(e){return!requestDefaultActions.includes(e)}).reduce(function(e,n){return objectSpread2(objectSpread2({},e),{},defineProperty({},getActionName(i,n),createReducerCase(function(e,t){var r=t.payload,a=t.meta,t={};return addMappedPayloadToState({obj:t,payloadMap:b,name:i,payload:r,payloadField:r,state:e,mainState:e,reducerName:u,action:n,instance:null==a?void 0:a.instance}),t})))},{})),{},(defineProperty(t={},getRunName(i),createReducerCase(function(e,t){var r=t.payload,a=t.meta,t=defineProperty({},getNameWithInstance(DefaultStateNames.isLoading(i),null==a?void 0:a.instance),!0);return addMappedPayloadToState({obj:t,payloadMap:b,name:i,payload:r,payloadField:r,state:e,mainState:e,reducerName:u,action:"run",instance:null==a?void 0:a.instance}),t})),defineProperty(t,getSuccessName(i),createReducerCase(function(e,t){var r=t.payload,a=t.meta,n=l||d,o=null!==(c=n?n(r,mergableRemoveSymbol):r)&&void 0!==c?c:y,t=getNameWithInstance(DefaultStateNames.result(i),!g||null==a?void 0:a.instance),n=p||f,c=(defineProperty(c={},getNameWithInstance(DefaultStateNames.isLoading(i),null==a?void 0:a.instance),!1),defineProperty(c,t,n?n(o,null!==(n=e[t])&&void 0!==n?n:m):mergePayloadByKey(null!==(t=e[t])&&void 0!==t?t:m,o,s)),c);return addMappedPayloadToState({obj:c,payloadMap:b,name:i,payload:r,payloadField:r,state:e,mainState:e,reducerName:u,action:"success",isMainAction:!0,instance:null==a?void 0:a.instance}),c})),defineProperty(t,getFailName(i),createReducerCase(function(e,t){var r=t.payload,a=t.meta,t=defineProperty({},getNameWithInstance(DefaultStateNames.isLoading(i),null==a?void 0:a.instance),!1);return addMappedPayloadToState({obj:t,payloadMap:b,name:i,payload:r,payloadField:r,state:e,mainState:e,reducerName:u,instance:null==a?void 0:a.instance,action:"fail"}),t})),t))}},simpleDefaultActions=["set","reset"],simpleGen={actions:function(e){var r=e.name,e=e.actions;return objectSpread2({set:createAction(getSetName(r)),reset:createAction(getResetName(r))},(e||[]).filter(function(e){return!simpleDefaultActions.includes(e)}).reduce(function(e,t){return objectSpread2(objectSpread2({},e),{},defineProperty({},t,createAction(getActionName(r,t))))},{}))},actionNames:function(e){var r=e.name,e=e.actions;return objectSpread2({set:getSetName(r),reset:getResetName(r)},(e||[]).filter(function(e){return!simpleDefaultActions.includes(e)}).reduce(function(e,t){return objectSpread2(objectSpread2({},e),{},defineProperty({},t,getActionName(r,t)))},{}))},selectors:function(e){var t=e.name,r=e.reducerName,a=e.payloadMap,n=void 0===a?{}:a,a=e.defaultInitial,e=function(e){return e[r]};return objectSpread2({value:selectorWithInstances(e,DefaultStateNames.value(t),a)},getSelectors(n,t,e))},initialState:function(e){var t=e.name,r=e.defaultInitial,r=void 0===r?null:r,e=e.payloadMap,e=void 0===e?{}:e;return objectSpread2(defineProperty({},DefaultStateNames.value(t),r),getInitial(e,t))},stateNames:function(e){var t=e.name,e=e.payloadMap,e=void 0===e?{}:e;return objectSpread2({value:DefaultStateNames.value(t)},getStateNames(e,t))},reducer:function(e){var c=e.name,i=e.mergeByKey,t=e.defaultInitial,u=void 0===t?null:t,t=e.defaultFallback,l=void 0===t?null:t,d=e.defaultInstanced,s=e.formatPayload,f=e.formatMergePayload,t=e.actions,p=e.reducerName,y=e.modifyValue,m=e.actionToValue,e=e.payloadMap,g=void 0===e?{}:e;return objectSpread2(objectSpread2({},(t||[]).filter(function(e){return!simpleDefaultActions.includes(e)}).reduce(function(e,n){return objectSpread2(objectSpread2({},e),{},defineProperty({},getActionName(c,n),createReducerCase(function(e,t){var r=t.payload,a=t.meta,t={};return addMappedPayloadToState({obj:t,payloadMap:g,name:c,payload:r,payloadField:r,state:e,instance:null==a?void 0:a.instance,mainState:e,reducerName:p,action:n}),t})))},{})),{},(defineProperty(t={},getSetName(c),createReducerCase(function(e,t){var r=t.payload,a=t.meta,n=s||f,t=null!==(o=n?n(r,mergableRemoveSymbol):r)&&void 0!==o?o:l,n=getNameWithInstance(DefaultStateNames.value(c),!d||null==a?void 0:a.instance),o=m||y,t=defineProperty({},n,o?o(r,null!==(o=e[n])&&void 0!==o?o:u):mergePayloadByKey(null!==(n=e[n])&&void 0!==n?n:u,t,i));return addMappedPayloadToState({obj:t,payloadMap:g,name:c,payload:r,payloadField:r,state:e,mainState:e,reducerName:p,instance:null==a?void 0:a.instance,action:"set",isMainAction:!0}),t})),defineProperty(t,getResetName(c),createReducerCase(function(e,t){var r=t.payload,a=t.meta,n=getNameWithInstance(DefaultStateNames.value(c),!d||null==a?void 0:a.instance),t=objectSpread2(defineProperty({},n,u),getInitial(g,c,null==a?void 0:a.instance,"reset")),n={};return addMappedPayloadToState({obj:n,payloadMap:g,name:c,payload:r,payloadField:r,state:e,mainState:e,reducerName:p,instance:null==a?void 0:a.instance,action:"reset"}),mergeObjects(t,n)})),t))}},requestErrorGen={stateNames:function(e){e=e.name;return{error:getErrorName(e)}},initialState:function(e){e=e.name;return defineProperty({},getErrorName(e),null)},selectors:function(e){var t=e.name,e=e.reducerName;return{error:createSelector(e,getErrorName(t))}},actions:function(e){e=e.name;return{fail:createAction(getFailName(e),function(e){var t;return null!==(t=null==e?void 0:e.error)&&void 0!==t?t:e})}},reducer:function(e){var a=e.name,e={};return defineProperty(e,getRunName(a),createReducerCase(function(e,t){t=t.meta;return defineProperty({},getNameWithInstance(getErrorName(a),null==t?void 0:t.instance),null)})),defineProperty(e,getSuccessName(a),createReducerCase(function(e,t){t=t.meta;return defineProperty({},getNameWithInstance(getErrorName(a),null==t?void 0:t.instance),null)})),defineProperty(e,getFailName(a),createReducerCase(function(e,t){var r=t.payload,t=t.meta;return defineProperty({},getNameWithInstance(getErrorName(a),null==t?void 0:t.instance),r)})),e}},resetState=function e(r,a,n){var o=Object.keys(a);Object.keys(r).forEach(function(t){o.filter(function(e){return e.startsWith(t)&&/ \[Instance]: .+$/.test(e)}).forEach(function(e){n[e]=removeMark}),r[t]&&a[t]&&"object"===_typeof_1(r[t])&&"object"===_typeof_1(a[t])&&e(r[t],a[t],n[t])})},resetActionGen={actions:function(e){e=e.name;return{reset:createAction(getResetName(e))}},reducer:function(e,r){e=e.name;return defineProperty({},getResetName(e),createReducerCase(function(e){var t=objectSpread2({},null==r?void 0:r.initialState);return resetState((null==r?void 0:r.initialState)||{},e,t),t}))}},generateColorByHash=function(e){var t,r=0;if(0===e.length)return"#000000";for(t=0;t<e.length;t++)r=(r<<3)-r+2*e.charCodeAt(t),r|=8;var a="".concat(r).replace("-","").split("").reverse().join("");return"#".concat(Math.floor(16777215*+"0.".concat(a)).toString(16).padEnd(6,"8"))},globalReducerSkip=Symbol("[CRPack]: global reducer skip"),createReduxPack=Object.assign(function(e){var t=formatParams(e,createReduxPack._idGeneration),r=t.reducerName,a=t.template,e=void 0===a?"request":a,a=t.name;createReduxPack._history[r]=defineProperty({updated:!1},a,(new Date).toISOString());var a=createReduxPack._generators[e]||createReduxPack._generators.request,n=getLazyPack(a,t),e=n.reducer,a=n.initialState;return createReduxPack.injectReducerInto(r,e,a),Object.assign(n,{withGenerator:function(e){return createReduxPack.withGenerator(t,e,n)}})},{_reducers:{},_history:new Proxy({},{get:function(e,t,r){return"print"!==t?Reflect.get(e,t,r):function(){return console.log({CRPackHistory:e})}},set:function(e,t,r,a){return Reflect.set(e,t,objectSpread2(objectSpread2({},Reflect.get(e,t,a)),r))}}),_initialState:{},isLoggerOn:!1,getRootReducer:function(r,t){var n=Object.keys(r||{}).reduce(function(e,t){return objectSpread2(objectSpread2({},e),e[t]?defineProperty({},t,objectSpread2(objectSpread2({},e[t]),(r||{})[t])):defineProperty({},t,(r||{})[t]))},createReduxPack._reducers);createReduxPack._reducers=n;var c=new Set,e=Object.keys(n).reduce(function(e,r){var a=t&&t[r]?objectSpread2(objectSpread2({},createReduxPack._initialState[r]),t[r]):createReduxPack._initialState[r];return createReduxPack._initialState[r]=a,objectSpread2(objectSpread2({},e),{},defineProperty({},r,"object"===_typeof_1(n[r])?createReducer(a,n[r],function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:a,t=createReduxPack._history[r];return null!=t&&t.updated?e:(c.add(r),objectSpread2(objectSpread2({},a),e))}):n[r]))},{}),a=Object.keys(e).length?redux.combineReducers(e):function(e){return e};return function(n,o){if(o.type in createReduxPack._globalReducers){var e=createReduxPack._globalReducers[o.type](n,o,globalReducerSkip);if(e!==globalReducerSkip)return e}function t(e){var t,r,a;createReduxPack.isLoggerOn&&(hasCRPackName(o.type)?console.groupCollapsed("[CRPack_Logger]: ".concat(o.type," %cww"),"color:transparent;background-color: ".concat(generateColorByHash((null===(t=o.type)||void 0===t||null===(r=t.match)||void 0===r||null===(a=r.call(t,CRPackRegex))||void 0===a?void 0:a[0])||o.type))):console.groupCollapsed("[CRPack_Logger]: %c".concat(o.type),"font-weight: bold"),console.log({previousState:n}),console.log({action:o}),console.log({nextState:e}),console.groupEnd())}if(o.type===resetAction.type)return t(createReduxPack._initialState),createReduxPack._initialState;e=a(n,o);return c.size&&c.forEach(function(e){createReduxPack._history[e]={updated:(new Date).toISOString()}}),t(e),e}},_globalReducers:{},addGlobalReducers:function(e){var t=createReduxPack._globalReducers;createReduxPack._globalReducers=objectSpread2(objectSpread2({},t),e)},withGenerator:function(t,e,r,a){var n=t.reducerName,o=t.template,o=a||createReduxPack._generators[void 0===o?"request":o]||createReduxPack._generators.request,c=mergeGenerators(o,e),i=getLazyPack(c,t,r);return createReduxPack.injectReducerInto(n,i.reducer,i.initialState),Object.assign(i,{withGenerator:function(e){return createReduxPack.withGenerator(t,e,i,c)}})},updateReducer:function(){createReduxPack._store&&!createReduxPack.preventReducerUpdates&&createReduxPack._store.replaceReducer(createReduxPack.getRootReducer())},_idGeneration:!0,setDefaultIdGeneration:function(e){createReduxPack._idGeneration=e},injectReducerInto:function(e,t,r){createReduxPack._reducers=objectSpread2(objectSpread2({},createReduxPack._reducers),createReduxPack._reducers[e]?defineProperty({},e,objectSpread2(objectSpread2({},createReduxPack._reducers[e]),t)):defineProperty({},e,t)),createReduxPack._initialState=objectSpread2(objectSpread2({},createReduxPack._initialState),createReduxPack._initialState[e]?defineProperty({},e,objectSpread2({},mergeObjects(createReduxPack._initialState[e],r))):defineProperty({},e,r)),createReduxPack.updateReducer()},preventReducerUpdates:!1,freezeReducerUpdates:function(){createReduxPack.preventReducerUpdates=!0},releaseReducerUpdates:function(){createReduxPack.preventReducerUpdates=!1,createReduxPack.updateReducer()},_store:null,_generators:{request:requestGen,simple:simpleGen},simpleDefaultActions:simpleDefaultActions,requestDefaultActions:requestDefaultActions,getRunName:getRunName,getSuccessName:getSuccessName,getSetName:getSetName,getResetName:getResetName,getFailName:getFailName,getActionName:getActionName,getLoadingName:getLoadingName,getResultName:getResultName,getValueName:getValueName,getErrorName:getErrorName,getKeyName:getKeyName,getNameWithInstance:getNameWithInstance}),enableLogger=function(){createReduxPack.isLoggerOn||(createReduxPack.isLoggerOn=!0,createReduxPack.updateReducer())},disableLogger=function(){createReduxPack.isLoggerOn&&(createReduxPack.isLoggerOn=!1,createReduxPack.updateReducer())},createStore=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];var a=redux.createStore.apply(void 0,[createReduxPack.getRootReducer()].concat(t));return createReduxPack._store=a},connectStore=function(e,t,r){if(createReduxPack._store=e,!t)return createReduxPack.updateReducer(),console.warn("CRPack connectStore didn't receive a reducer, if there are none, please use CRPack's createStore utility instead");"object"===_typeof_1(t)&&(t=Object.entries(t),createReduxPack._reducers=mergeObjects(createReduxPack._reducers,t.reduce(function(e,t){var r=slicedToArray(t,2),t=r[0],r=r[1];return"function"==typeof r?objectSpread2(objectSpread2({},e),{},defineProperty({},t,r)):e},{})),createReduxPack._initialState=mergeObjects(createReduxPack._initialState,r||t.reduce(function(e,t){var r=slicedToArray(t,2),t=r[0],r=r[1];return"function"==typeof r?objectSpread2(objectSpread2({},e),{},defineProperty({},t,r(void 0,{type:"[CRPack]: init ".concat(generateId(6))}))):e},{})||{}),createReduxPack.updateReducer())},createReducerOn=function(e,t,r){createReduxPack._history[e]={updated:!1},createReduxPack.injectReducerInto(e||"UnspecifiedReducer",r||{},t||{})};exports.connectStore=connectStore,exports.createAction=createAction,exports.createReducerCase=createReducerCase,exports.createReducerOn=createReducerOn,exports.createSelector=createSelector,exports.createStore=createStore,exports.default=createReduxPack,exports.disableLogger=disableLogger,exports.enableLogger=enableLogger,exports.makeKeysReadable=makeKeysReadable,exports.mergableRemoveSymbol=mergableRemoveSymbol,exports.mergeGenerators=mergeGenerators,exports.requestErrorGen=requestErrorGen,exports.resetAction=resetAction,exports.resetActionGen=resetActionGen;
